using Microsoft.EntityFrameworkCore;
using ECommercePlateform.Server.Models;

namespace ECommercePlateform.Server.Data
{
    public class AppDbContext : DbContext
    {
        public AppDbContext(DbContextOptions<AppDbContext> options)
            : base(options)
        {
        }

        // DbSet properties for all entities
        public DbSet<User> Users { get; set; }
        public DbSet<Address> Addresses { get; set; }
        public DbSet<Cart> Carts { get; set; }
        public DbSet<CartItem> CartItems { get; set; }
        public DbSet<City> Cities { get; set; }
        public DbSet<Country> Countries { get; set; }
        public DbSet<Coupen> Coupens { get; set; }
        public DbSet<Order> Orders { get; set; }
        public DbSet<OrderItem> OrderItems { get; set; }
        public DbSet<Product> Products { get; set; }
        public DbSet<ProductVarient> ProductVarients { get; set; }
        public DbSet<Review> Reviews { get; set; }
        public DbSet<Setting> Settings { get; set; }
        public DbSet<ShippingAddress> ShippingAddresses { get; set; }
        public DbSet<State> States { get; set; }

        protected override void OnModelCreating(ModelBuilder modelBuilder)
        {
            base.OnModelCreating(modelBuilder);

            // Configure entity relationships
            // User entity configurations
            modelBuilder.Entity<User>(entity =>
            {
                entity.HasKey(e => e.Id);
                entity.Property(e => e.FirstName).IsRequired().HasMaxLength(50);
                entity.Property(e => e.LastName).IsRequired().HasMaxLength(50);
                entity.Property(e => e.Email).IsRequired().HasMaxLength(254);
                entity.Property(e => e.Password).IsRequired().HasMaxLength(100);
                entity.Property(e => e.PhoneNumber).IsRequired().HasMaxLength(15);
                
                // Configure one-to-many relationships
                entity.HasMany(u => u.Addresses)
                    .WithOne(a => a.User)
                    .HasForeignKey(a => a.UserId)
                    .OnDelete(DeleteBehavior.Restrict);

                entity.HasMany(u => u.Carts)
                    .WithOne(c => c.User)
                    .HasForeignKey(c => c.UserId)
                    .OnDelete(DeleteBehavior.Restrict);

                entity.HasMany(u => u.Orders)
                    .WithOne(o => o.User)
                    .HasForeignKey(o => o.UserId)
                    .OnDelete(DeleteBehavior.Restrict);

                entity.HasMany(u => u.Reviews)
                    .WithOne(r => r.User)
                    .HasForeignKey(r => r.UserId)
                    .OnDelete(DeleteBehavior.Restrict);

                entity.HasMany(u => u.ShippingAddresses)
                    .WithOne(s => s.User)
                    .HasForeignKey(s => s.UserId)
                    .OnDelete(DeleteBehavior.Restrict);
            });

            // Address entity configurations
            modelBuilder.Entity<Address>(entity =>
            {
                entity.HasKey(e => e.Id);
                entity.Property(e => e.Line1).IsRequired().HasMaxLength(100);
                entity.Property(e => e.Line2).HasMaxLength(100);
                entity.Property(e => e.Line3).HasMaxLength(100);
                entity.Property(e => e.ZipCode).IsRequired().HasMaxLength(18);

                entity.HasOne(a => a.City)
                    .WithMany(c => c.Addresses)
                    .HasForeignKey(a => a.CityId)
                    .OnDelete(DeleteBehavior.Restrict);

                entity.HasOne(a => a.State)
                    .WithMany(s => s.Addresses)
                    .HasForeignKey(a => a.StateId)
                    .OnDelete(DeleteBehavior.Restrict);

                entity.HasOne(a => a.Country)
                    .WithMany(c => c.Addresses)
                    .HasForeignKey(a => a.CountryId)
                    .OnDelete(DeleteBehavior.Restrict);
            });

            // Cart entity configurations
            modelBuilder.Entity<Cart>(entity =>
            {
                entity.HasKey(e => e.Id);
                entity.Property(e => e.TotalItems).IsRequired();
                entity.Property(e => e.TotalAmount).IsRequired().HasPrecision(18, 2);

                entity.HasMany(c => c.CartItems)
                    .WithOne(ci => ci.Cart)
                    .HasForeignKey(ci => ci.CartId)
                    .OnDelete(DeleteBehavior.Cascade);
            });

            // CartItem entity configurations
            modelBuilder.Entity<CartItem>(entity =>
            {
                entity.HasKey(e => e.Id);
                entity.Property(e => e.Quantity).IsRequired();
                entity.Property(e => e.UnitPrice).IsRequired().HasPrecision(18, 2);

                entity.HasOne(ci => ci.Product)
                    .WithMany(p => p.CartItems)
                    .HasForeignKey(ci => ci.ProductId)
                    .OnDelete(DeleteBehavior.Restrict);

                entity.HasOne(ci => ci.ProductVarient)
                    .WithMany(pv => pv.CartItems)
                    .HasForeignKey(ci => ci.ProductVarientId)
                    .OnDelete(DeleteBehavior.Restrict);
            });

            // City entity configurations
            modelBuilder.Entity<City>(entity =>
            {
                entity.HasKey(e => e.Id);
                entity.Property(e => e.Name).IsRequired().HasMaxLength(100);

                entity.HasOne(c => c.State)
                    .WithMany(s => s.Cities)
                    .HasForeignKey(c => c.StateId)
                    .OnDelete(DeleteBehavior.Restrict);
            });

            // Country entity configurations
            modelBuilder.Entity<Country>(entity =>
            {
                entity.HasKey(e => e.Id);
                entity.Property(e => e.Name).IsRequired().HasMaxLength(100);
                entity.Property(e => e.Code).IsRequired().HasMaxLength(10);
            });

            // Coupen entity configurations
            modelBuilder.Entity<Coupen>(entity =>
            {
                entity.HasKey(e => e.Id);
                entity.Property(e => e.Name).IsRequired().HasMaxLength(100);
                entity.Property(e => e.Code).IsRequired().HasMaxLength(100);
                entity.Property(e => e.DiscountValue).IsRequired().HasPrecision(18, 2);
                entity.Property(e => e.MinimumValue).HasPrecision(18, 2);
                entity.Property(e => e.MaximumValue).HasPrecision(18, 2);

                entity.HasOne(c => c.Product)
                    .WithMany(p => p.Coupens)
                    .HasForeignKey(c => c.ProductId)
                    .OnDelete(DeleteBehavior.Restrict);

                entity.HasOne(c => c.ProductVarient)
                    .WithMany(pv => pv.Coupens)
                    .HasForeignKey(c => c.ProductVarientId)
                    .OnDelete(DeleteBehavior.Restrict);
            });

            // Order entity configurations
            modelBuilder.Entity<Order>(entity =>
            {
                entity.HasKey(e => e.Id);
                entity.Property(e => e.OrderNumber).IsRequired().HasMaxLength(255);
                entity.Property(e => e.SubTotal).IsRequired().HasPrecision(18, 2);
                entity.Property(e => e.DiscountAmount).IsRequired().HasPrecision(18, 2);
                entity.Property(e => e.TaxAmount).IsRequired().HasPrecision(18, 2);
                entity.Property(e => e.ShippingAmount).IsRequired().HasPrecision(18, 2);
                entity.Property(e => e.TotalAmount).IsRequired().HasPrecision(18, 2);

                entity.HasOne(o => o.ShippingAddress)
                    .WithMany(sa => sa.Orders)
                    .HasForeignKey(o => o.ShippingAddressId)
                    .OnDelete(DeleteBehavior.Restrict);

                entity.HasOne(o => o.Coupen)
                    .WithMany(c => c.Orders)
                    .HasForeignKey(o => o.CoupenId)
                    .OnDelete(DeleteBehavior.Restrict);

                entity.HasMany(o => o.OrderItems)
                    .WithOne(oi => oi.Order)
                    .HasForeignKey(oi => oi.OrderId)
                    .OnDelete(DeleteBehavior.Cascade);
            });

            // OrderItem entity configurations
            modelBuilder.Entity<OrderItem>(entity =>
            {
                entity.HasKey(e => e.Id);
                entity.Property(e => e.ProductName).IsRequired().HasMaxLength(100);
                entity.Property(e => e.SKU).HasMaxLength(50);
                entity.Property(e => e.Quantity).IsRequired();
                entity.Property(e => e.UnitPrice).IsRequired().HasPrecision(18, 2);
                entity.Property(e => e.TotalPrice).IsRequired().HasPrecision(18, 2);

                entity.HasOne(oi => oi.Product)
                    .WithMany(p => p.OrderItems)
                    .HasForeignKey(oi => oi.ProductId)
                    .OnDelete(DeleteBehavior.Restrict);

                entity.HasOne(oi => oi.ProductVarient)
                    .WithMany(pv => pv.OrderItems)
                    .HasForeignKey(oi => oi.ProductVarientId)
                    .OnDelete(DeleteBehavior.Restrict);
            });

            // Product entity configurations
            modelBuilder.Entity<Product>(entity =>
            {
                entity.HasKey(e => e.Id);
                entity.Property(e => e.Name).IsRequired().HasMaxLength(100);
                entity.Property(e => e.Description).IsRequired().HasMaxLength(500);
                entity.Property(e => e.BasePrice).IsRequired().HasPrecision(18, 2);
                entity.Property(e => e.SKU).IsRequired().HasMaxLength(50);
                entity.Property(e => e.Tags).IsRequired().HasMaxLength(100);

                entity.HasMany(p => p.ProductVarients)
                    .WithOne(pv => pv.Product)
                    .HasForeignKey(pv => pv.ProductId)
                    .OnDelete(DeleteBehavior.Cascade);

                entity.HasMany(p => p.Reviews)
                    .WithOne(r => r.Product)
                    .HasForeignKey(r => r.ProductId)
                    .OnDelete(DeleteBehavior.Restrict);
            });

            // ProductVarient entity configurations
            modelBuilder.Entity<ProductVarient>(entity =>
            {
                entity.HasKey(e => e.Id);
                entity.Property(e => e.Name).IsRequired();
                entity.Property(e => e.Color).HasMaxLength(50);
                entity.Property(e => e.Size).HasMaxLength(50);
                entity.Property(e => e.Description).IsRequired().HasMaxLength(500);
                entity.Property(e => e.Price).IsRequired().HasPrecision(18, 2);
                entity.Property(e => e.SKU).IsRequired().HasMaxLength(50);
                entity.Property(e => e.Tags).IsRequired().HasMaxLength(100);
                entity.Property(e => e.StockQuantity).IsRequired();
            });

            // Review entity configurations
            modelBuilder.Entity<Review>(entity =>
            {
                entity.HasKey(e => e.Id);
                entity.Property(e => e.Rating).IsRequired();
                entity.Property(e => e.ReviewText).IsRequired().HasMaxLength(255);
            });

            // Setting entity configurations
            modelBuilder.Entity<Setting>(entity =>
            {
                entity.HasKey(e => e.Id);
                entity.Property(e => e.TaxRate).IsRequired().HasPrecision(18, 2);
                entity.Property(e => e.DeliveryFee).IsRequired().HasPrecision(18, 2);
                entity.Property(e => e.FreeDeliveryAbove).IsRequired().HasPrecision(18, 2);
            });

            // ShippingAddress entity configurations
            modelBuilder.Entity<ShippingAddress>(entity =>
            {
                entity.HasKey(e => e.Id);
                entity.Property(e => e.Line1).IsRequired().HasMaxLength(100);
                entity.Property(e => e.Line2).HasMaxLength(100);
                entity.Property(e => e.Line3).HasMaxLength(100);
                entity.Property(e => e.ZipCode).IsRequired().HasMaxLength(18);

                entity.HasOne(sa => sa.City)
                    .WithMany(c => c.ShippingAddresses)
                    .HasForeignKey(sa => sa.CityId)
                    .OnDelete(DeleteBehavior.Restrict);

                entity.HasOne(sa => sa.State)
                    .WithMany(s => s.ShippingAddresses)
                    .HasForeignKey(sa => sa.StateId)
                    .OnDelete(DeleteBehavior.Restrict);

                entity.HasOne(sa => sa.Country)
                    .WithMany(c => c.ShippingAddresses)
                    .HasForeignKey(sa => sa.CountryId)
                    .OnDelete(DeleteBehavior.Restrict);
            });

            // State entity configurations
            modelBuilder.Entity<State>(entity =>
            {
                entity.HasKey(e => e.Id);
                entity.Property(e => e.Name).IsRequired().HasMaxLength(100);
                entity.Property(e => e.Code).IsRequired().HasMaxLength(10);

                entity.HasOne(s => s.Country)
                    .WithMany(c => c.States)
                    .HasForeignKey(s => s.CountryId)
                    .OnDelete(DeleteBehavior.Restrict);
            });

            // Handle circular references and self-references by ignoring some navigation properties
            foreach (var entityType in modelBuilder.Model.GetEntityTypes())
            {
                var selfReferences = entityType.GetNavigations()
                    .Where(n => n.TargetEntityType.Name == entityType.Name);

                foreach (var selfReference in selfReferences)
                {
                    entityType.FindNavigation(selfReference.Name)?.SetField(null);
                    entityType.FindNavigation(selfReference.Name)?.SetPropertyAccessMode(PropertyAccessMode.Field);
                }
            }
            
            // Configure indexes for better query performance
            modelBuilder.Entity<User>().HasIndex(u => u.Email).IsUnique();
            modelBuilder.Entity<User>().HasIndex(u => u.PhoneNumber);
            modelBuilder.Entity<Product>().HasIndex(p => p.SKU).IsUnique();
            modelBuilder.Entity<ProductVarient>().HasIndex(pv => pv.SKU).IsUnique();
            modelBuilder.Entity<Order>().HasIndex(o => o.OrderNumber).IsUnique();
            modelBuilder.Entity<Coupen>().HasIndex(c => c.Code).IsUnique();
        }
    }
}

using Microsoft.EntityFrameworkCore;
using ECommercePlateform.Server.Models;
using System;

namespace ECommercePlateform.Server.Data
{
    public class AppDbContext : DbContext
    {
        public AppDbContext(DbContextOptions<AppDbContext> options) : base(options)
        {
        }

        // DbSet properties for all models
        public DbSet<Address> Addresses { get; set; }
        public DbSet<Cart> Carts { get; set; }
        public DbSet<CartItem> CartItems { get; set; }
        public DbSet<City> Cities { get; set; }
        public DbSet<Country> Countries { get; set; }
        public DbSet<Coupen> Coupens { get; set; }
        public DbSet<Order> Orders { get; set; }
        public DbSet<OrderItem> OrderItems { get; set; }
        public DbSet<Product> Products { get; set; }
        public DbSet<ProductVarient> ProductVarients { get; set; }
        public DbSet<Review> Reviews { get; set; }
        public DbSet<Setting> Settings { get; set; }
        public DbSet<ShippingAddress> ShippingAddresses { get; set; }
        public DbSet<State> States { get; set; }
        public DbSet<User> Users { get; set; }

        protected override void OnModelCreating(ModelBuilder modelBuilder)
        {
            base.OnModelCreating(modelBuilder);

            // User configuration
            modelBuilder.Entity<User>(entity =>
            {
                entity.HasKey(e => e.Id);
                entity.Property(e => e.FirstName).IsRequired().HasMaxLength(50);
                entity.Property(e => e.LastName).IsRequired().HasMaxLength(50);
                entity.Property(e => e.Email).IsRequired().HasMaxLength(254);
                entity.HasIndex(e => e.Email).IsUnique();
                entity.Property(e => e.PhoneNumber).IsRequired().HasMaxLength(15);
                entity.HasIndex(e => e.PhoneNumber).IsUnique();
                entity.Property(e => e.Password).IsRequired().HasMaxLength(100);
                
                // Ignore circular references to avoid complex mapping
                entity.Ignore(e => e.Addresses);
                entity.Ignore(e => e.Carts);
                entity.Ignore(e => e.CartItems);
                entity.Ignore(e => e.Cities);
                entity.Ignore(e => e.Countries);
                entity.Ignore(e => e.Coupens);
                entity.Ignore(e => e.Orders);
                entity.Ignore(e => e.OrderItems);
                entity.Ignore(e => e.Products);
                entity.Ignore(e => e.ProductVarients);
                entity.Ignore(e => e.Reviews);
                entity.Ignore(e => e.Settings);
                entity.Ignore(e => e.ShippingAddresses);
                entity.Ignore(e => e.States);
                entity.Ignore(e => e.Users);
            });

            // Country configuration
            modelBuilder.Entity<Country>(entity =>
            {
                entity.HasKey(e => e.Id);
                entity.Property(e => e.Name).IsRequired().HasMaxLength(100);
                entity.Property(e => e.Code).IsRequired().HasMaxLength(10);
                entity.HasIndex(e => e.Code).IsUnique();
                
                // Ignore circular references
                entity.Ignore(e => e.Addresses);
                entity.Ignore(e => e.Carts);
                entity.Ignore(e => e.CartItems);
                entity.Ignore(e => e.Cities);
                entity.Ignore(e => e.Countries);
                entity.Ignore(e => e.Coupens);
                entity.Ignore(e => e.Orders);
                entity.Ignore(e => e.OrderItems);
                entity.Ignore(e => e.Products);
                entity.Ignore(e => e.ProductVarients);
                entity.Ignore(e => e.Reviews);
                entity.Ignore(e => e.Settings);
                entity.Ignore(e => e.ShippingAddresses);
                entity.Ignore(e => e.States);
                entity.Ignore(e => e.Users);
            });

            // State configuration
            modelBuilder.Entity<State>(entity =>
            {
                entity.HasKey(e => e.Id);
                entity.Property(e => e.Name).IsRequired().HasMaxLength(100);
                entity.Property(e => e.Code).IsRequired().HasMaxLength(10);
                entity.HasIndex(e => new { e.Code, e.CountryId }).IsUnique();
                
                entity.HasOne(e => e.Country)
                    .WithMany(c => c.States)
                    .HasForeignKey(e => e.CountryId)
                    .OnDelete(DeleteBehavior.Restrict);
                
                // Ignore circular references
                entity.Ignore(e => e.Addresses);
                entity.Ignore(e => e.Carts);
                entity.Ignore(e => e.CartItems);
                entity.Ignore(e => e.Cities);
                entity.Ignore(e => e.Countries);
                entity.Ignore(e => e.Coupens);
                entity.Ignore(e => e.Orders);
                entity.Ignore(e => e.OrderItems);
                entity.Ignore(e => e.Products);
                entity.Ignore(e => e.ProductVarients);
                entity.Ignore(e => e.Reviews);
                entity.Ignore(e => e.Settings);
                entity.Ignore(e => e.ShippingAddresses);
                entity.Ignore(e => e.States);
                entity.Ignore(e => e.Users);
            });

            // City configuration
            modelBuilder.Entity<City>(entity =>
            {
                entity.HasKey(e => e.Id);
                entity.Property(e => e.Name).IsRequired().HasMaxLength(100);
                entity.HasIndex(e => new { e.Name, e.StateId }).IsUnique();
                
                entity.HasOne(e => e.State)
                    .WithMany(s => s.Cities)
                    .HasForeignKey(e => e.StateId)
                    .OnDelete(DeleteBehavior.Restrict);
                
                // Ignore circular references
                entity.Ignore(e => e.Addresses);
                entity.Ignore(e => e.Carts);
                entity.Ignore(e => e.CartItems);
                entity.Ignore(e => e.Cities);
                entity.Ignore(e => e.Countries);
                entity.Ignore(e => e.Coupens);
                entity.Ignore(e => e.Orders);
                entity.Ignore(e => e.OrderItems);
                entity.Ignore(e => e.Products);
                entity.Ignore(e => e.ProductVarients);
                entity.Ignore(e => e.Reviews);
                entity.Ignore(e => e.Settings);
                entity.Ignore(e => e.ShippingAddresses);
                entity.Ignore(e => e.States);
                entity.Ignore(e => e.Users);
            });

            // Address configuration
            modelBuilder.Entity<Address>(entity =>
            {
                entity.HasKey(e => e.Id);
                entity.Property(e => e.Line1).IsRequired().HasMaxLength(100);
                entity.Property(e => e.ZipCode).IsRequired().HasMaxLength(18);
                
                entity.HasOne(e => e.User)
                    .WithMany(u => u.Addresses)
                    .HasForeignKey(e => e.UserId)
                    .OnDelete(DeleteBehavior.Restrict);
                
                entity.HasOne(e => e.City)
                    .WithMany()
                    .HasForeignKey(e => e.CityId)
                    .OnDelete(DeleteBehavior.Restrict);
                
                entity.HasOne(e => e.State)
                    .WithMany()
                    .HasForeignKey(e => e.StateId)
                    .OnDelete(DeleteBehavior.Restrict);
                
                entity.HasOne(e => e.Country)
                    .WithMany()
                    .HasForeignKey(e => e.CountryId)
                    .OnDelete(DeleteBehavior.Restrict);
                
                // Ignore circular references
                entity.Ignore(e => e.Addresses);
                entity.Ignore(e => e.Carts);
                entity.Ignore(e => e.CartItems);
                entity.Ignore(e => e.Cities);
                entity.Ignore(e => e.Countries);
                entity.Ignore(e => e.Coupens);
                entity.Ignore(e => e.Orders);
                entity.Ignore(e => e.OrderItems);
                entity.Ignore(e => e.Products);
                entity.Ignore(e => e.ProductVarients);
                entity.Ignore(e => e.Reviews);
                entity.Ignore(e => e.Settings);
                entity.Ignore(e => e.ShippingAddresses);
                entity.Ignore(e => e.States);
                entity.Ignore(e => e.Users);
            });

            // ShippingAddress configuration
            modelBuilder.Entity<ShippingAddress>(entity =>
            {
                entity.HasKey(e => e.Id);
                entity.Property(e => e.Line1).IsRequired().HasMaxLength(100);
                entity.Property(e => e.ZipCode).IsRequired().HasMaxLength(18);
                
                entity.HasOne(e => e.User)
                    .WithMany(u => u.ShippingAddresses)
                    .HasForeignKey(e => e.UserId)
                    .OnDelete(DeleteBehavior.Restrict);
                
                entity.HasOne(e => e.City)
                    .WithMany()
                    .HasForeignKey(e => e.CityId)
                    .OnDelete(DeleteBehavior.Restrict);
                
                entity.HasOne(e => e.State)
                    .WithMany()
                    .HasForeignKey(e => e.StateId)
                    .OnDelete(DeleteBehavior.Restrict);
                
                entity.HasOne(e => e.Country)
                    .WithMany()
                    .HasForeignKey(e => e.CountryId)
                    .OnDelete(DeleteBehavior.Restrict);
                
                // Ignore circular references
                entity.Ignore(e => e.Addresses);
                entity.Ignore(e => e.Carts);
                entity.Ignore(e => e.CartItems);
                entity.Ignore(e => e.Cities);
                entity.Ignore(e => e.Countries);
                entity.Ignore(e => e.Coupens);
                entity.Ignore(e => e.Orders);
                entity.Ignore(e => e.OrderItems);
                entity.Ignore(e => e.Products);
                entity.Ignore(e => e.ProductVarients);
                entity.Ignore(e => e.Reviews);
                entity.Ignore(e => e.Settings);
                entity.Ignore(e => e.ShippingAddresses);
                entity.Ignore(e => e.States);
                entity.Ignore(e => e.Users);
            });

            // Product configuration
            modelBuilder.Entity<Product>(entity =>
            {
                entity.HasKey(e => e.Id);
                entity.Property(e => e.Name).IsRequired().HasMaxLength(100);
                entity.Property(e => e.BasePrice).HasPrecision(18, 2);
                entity.Property(e => e.Description).HasMaxLength(500);
                entity.Property(e => e.SKU).HasMaxLength(50);
                entity.Property(e => e.ImageUrl).HasMaxLength(500);
                entity.Property(e => e.Tags).HasMaxLength(100);
                
                // Ignore circular references
                entity.Ignore(e => e.Addresses);
                entity.Ignore(e => e.Carts);
                entity.Ignore(e => e.CartItems);
                entity.Ignore(e => e.Cities);
                entity.Ignore(e => e.Countries);
                entity.Ignore(e => e.Coupens);
                entity.Ignore(e => e.Orders);
                entity.Ignore(e => e.OrderItems);
                entity.Ignore(e => e.Products);
                entity.Ignore(e => e.ProductVarients);
                entity.Ignore(e => e.Reviews);
                entity.Ignore(e => e.Settings);
                entity.Ignore(e => e.ShippingAddresses);
                entity.Ignore(e => e.States);
                entity.Ignore(e => e.Users);
            });

            // ProductVarient configuration
            modelBuilder.Entity<ProductVarient>(entity =>
            {
                entity.HasKey(e => e.Id);
                entity.Property(e => e.Name).IsRequired();
                entity.Property(e => e.Price).HasPrecision(18, 2);
                entity.Property(e => e.Color).HasMaxLength(50);
                entity.Property(e => e.Size).HasMaxLength(50);
                entity.Property(e => e.Description).HasMaxLength(500);
                entity.Property(e => e.SKU).HasMaxLength(50);
                entity.Property(e => e.ImageUrl).HasMaxLength(500);
                entity.Property(e => e.Tags).HasMaxLength(100);
                
                entity.HasOne(e => e.Product)
                    .WithMany(p => p.ProductVarients)
                    .HasForeignKey(e => e.ProductId)
                    .OnDelete(DeleteBehavior.Cascade);
                
                // Ignore circular references
                entity.Ignore(e => e.Addresses);
                entity.Ignore(e => e.Carts);
                entity.Ignore(e => e.CartItems);
                entity.Ignore(e => e.Cities);
                entity.Ignore(e => e.Countries);
                entity.Ignore(e => e.Coupens);
                entity.Ignore(e => e.Orders);
                entity.Ignore(e => e.OrderItems);
                entity.Ignore(e => e.Products);
                entity.Ignore(e => e.ProductVarients);
                entity.Ignore(e => e.Reviews);
                entity.Ignore(e => e.Settings);
                entity.Ignore(e => e.ShippingAddresses);
                entity.Ignore(e => e.States);
                entity.Ignore(e => e.Users);
            });

            // Cart configuration
            modelBuilder.Entity<Cart>(entity =>
            {
                entity.HasKey(e => e.Id);
                entity.Property(e => e.TotalAmount).HasPrecision(18, 2);
                
                entity.HasOne(e => e.User)
                    .WithMany(u => u.Carts)
                    .HasForeignKey(e => e.UserId)
                    .OnDelete(DeleteBehavior.Restrict);
                
                // Ignore circular references
                entity.Ignore(e => e.Addresses);
                entity.Ignore(e => e.Carts);
                entity.Ignore(e => e.CartItems);
                entity.Ignore(e => e.Cities);
                entity.Ignore(e => e.Countries);
                entity.Ignore(e => e.Coupens);
                entity.Ignore(e => e.Orders);
                entity.Ignore(e => e.OrderItems);
                entity.Ignore(e => e.Products);
                entity.Ignore(e => e.ProductVarients);
                entity.Ignore(e => e.Reviews);
                entity.Ignore(e => e.Settings);
                entity.Ignore(e => e.ShippingAddresses);
                entity.Ignore(e => e.States);
                entity.Ignore(e => e.Users);
            });

            // CartItem configuration
            modelBuilder.Entity<CartItem>(entity =>
            {
                entity.HasKey(e => e.Id);
                entity.Property(e => e.UnitPrice).HasPrecision(18, 2);
                
                entity.HasOne(e => e.Cart)
                    .WithMany(c => c.CartItems)
                    .HasForeignKey(e => e.CartId)
                    .OnDelete(DeleteBehavior.Cascade);
                
                entity.HasOne(e => e.Product)
                    .WithMany()
                    .HasForeignKey(e => e.ProductId)
                    .OnDelete(DeleteBehavior.Restrict);
                
                entity.HasOne(e => e.ProductVarient)
                    .WithMany()
                    .HasForeignKey(e => e.ProductVarientId)
                    .OnDelete(DeleteBehavior.Restrict);
                
                // Ignore circular references
                entity.Ignore(e => e.Addresses);
                entity.Ignore(e => e.Carts);
                entity.Ignore(e => e.CartItems);
                entity.Ignore(e => e.Cities);
                entity.Ignore(e => e.Countries);
                entity.Ignore(e => e.Coupens);
                entity.Ignore(e => e.Orders);
                entity.Ignore(e => e.OrderItems);
                entity.Ignore(e => e.Products);
                entity.Ignore(e => e.ProductVarients);
                entity.Ignore(e => e.Reviews);
                entity.Ignore(e => e.Settings);
                entity.Ignore(e => e.ShippingAddresses);
                entity.Ignore(e => e.States);
                entity.Ignore(e => e.Users);
            });

            // Coupen configuration
            modelBuilder.Entity<Coupen>(entity =>
            {
                entity.HasKey(e => e.Id);
                entity.Property(e => e.Name).IsRequired().HasMaxLength(100);
                entity.Property(e => e.Code).IsRequired().HasMaxLength(100);
                entity.HasIndex(e => e.Code).IsUnique();
                entity.Property(e => e.DiscountValue).HasPrecision(18, 2);
                entity.Property(e => e.MinimumValue).HasPrecision(18, 2);
                entity.Property(e => e.MaximumValue).HasPrecision(18, 2);
                
                entity.HasOne(e => e.Product)
                    .WithMany()
                    .HasForeignKey(e => e.ProductId)
                    .OnDelete(DeleteBehavior.Restrict);
                
                entity.HasOne(e => e.ProductVarient)
                    .WithMany()
                    .HasForeignKey(e => e.ProductVarientId)
                    .OnDelete(DeleteBehavior.Restrict);
                
                // Ignore circular references
                entity.Ignore(e => e.Addresses);
                entity.Ignore(e => e.Carts);
                entity.Ignore(e => e.CartItems);
                entity.Ignore(e => e.Cities);
                entity.Ignore(e => e.Countries);
                entity.Ignore(e => e.Coupens);
                entity.Ignore(e => e.Orders);
                entity.Ignore(e => e.OrderItems);
                entity.Ignore(e => e.Products);
                entity.Ignore(e => e.ProductVarients);
                entity.Ignore(e => e.Reviews);
                entity.Ignore(e => e.Settings);
                entity.Ignore(e => e.ShippingAddresses);
                entity.Ignore(e => e.States);
                entity.Ignore(e => e.Users);
            });

            // Order configuration
            modelBuilder.Entity<Order>(entity =>
            {
                entity.HasKey(e => e.Id);
                entity.Property(e => e.OrderNumber).IsRequired().HasMaxLength(255);
                entity.HasIndex(e => e.OrderNumber).IsUnique();
                entity.Property(e => e.SubTotal).HasPrecision(18, 2);
                entity.Property(e => e.DiscountAmount).HasPrecision(18, 2);
                entity.Property(e => e.TaxAmount).HasPrecision(18, 2);
                entity.Property(e => e.ShippingAmount).HasPrecision(18, 2);
                entity.Property(e => e.TotalAmount).HasPrecision(18, 2);
                
                entity.HasOne(e => e.User)
                    .WithMany(u => u.Orders)
                    .HasForeignKey(e => e.UserId)
                    .OnDelete(DeleteBehavior.Restrict);
                
                entity.HasOne(e => e.ShippingAddress)
                    .WithMany()
                    .HasForeignKey(e => e.ShippingAddressId)
                    .OnDelete(DeleteBehavior.Restrict);
                
                entity.HasOne(e => e.Coupen)
                    .WithMany()
                    .HasForeignKey(e => e.CoupenId)
                    .OnDelete(DeleteBehavior.Restrict);
                
                // Ignore circular references
                entity.Ignore(e => e.Addresses);
                entity.Ignore(e => e.Carts);
                entity.Ignore(e => e.CartItems);
                entity.Ignore(e => e.Cities);
                entity.Ignore(e => e.Countries);
                entity.Ignore(e => e.Coupens);
                entity.Ignore(e => e.Orders);
                entity.Ignore(e => e.OrderItems);
                entity.Ignore(e => e.Products);
                entity.Ignore(e => e.ProductVarients);
                entity.Ignore(e => e.Reviews);
                entity.Ignore(e => e.Settings);
                entity.Ignore(e => e.ShippingAddresses);
                entity.Ignore(e => e.States);
                entity.Ignore(e => e.Users);
            });

            // OrderItem configuration
            modelBuilder.Entity<OrderItem>(entity =>
            {
                entity.HasKey(e => e.Id);
                entity.Property(e => e.ProductName).IsRequired().HasMaxLength(100);
                entity.Property(e => e.SKU).HasMaxLength(50);
                entity.Property(e => e.UnitPrice).HasPrecision(18, 2);
                entity.Property(e => e.TotalPrice).HasPrecision(18, 2);
                
                entity.HasOne(e => e.Order)
                    .WithMany(o => o.OrderItems)
                    .HasForeignKey(e => e.OrderId)
                    .OnDelete(DeleteBehavior.Cascade);
                
                entity.HasOne(e => e.Product)
                    .WithMany()
                    .HasForeignKey(e => e.ProductId)
                    .OnDelete(DeleteBehavior.Restrict);
                
                entity.HasOne(e => e.ProductVarient)
                    .WithMany()
                    .HasForeignKey(e => e.ProductVarientId)
                    .OnDelete(DeleteBehavior.Restrict);
                
                // Ignore circular references
                entity.Ignore(e => e.Addresses);
                entity.Ignore(e => e.Carts);
                entity.Ignore(e => e.CartItems);
                entity.Ignore(e => e.Cities);
                entity.Ignore(e => e.Countries);
                entity.Ignore(e => e.Coupens);
                entity.Ignore(e => e.Orders);
                entity.Ignore(e => e.OrderItems);
                entity.Ignore(e => e.Products);
                entity.Ignore(e => e.ProductVarients);
                entity.Ignore(e => e.Reviews);
                entity.Ignore(e => e.Settings);
                entity.Ignore(e => e.ShippingAddresses);
                entity.Ignore(e => e.States);
                entity.Ignore(e => e.Users);
            });

            // Review configuration
            modelBuilder.Entity<Review>(entity =>
            {
                entity.HasKey(e => e.Id);
                entity.Property(e => e.ReviewText).IsRequired().HasMaxLength(255);
                
                entity.HasOne(e => e.Product)
                    .WithMany(p => p.Reviews)
                    .HasForeignKey(e => e.ProductId)
                    .OnDelete(DeleteBehavior.Restrict);
                
                entity.HasOne(e => e.User)
                    .WithMany(u => u.Reviews)
                    .HasForeignKey(e => e.UserId)
                    .OnDelete(DeleteBehavior.Restrict);
                
                // Ignore circular references
                entity.Ignore(e => e.Addresses);
                entity.Ignore(e => e.Carts);
                entity.Ignore(e => e.CartItems);
                entity.Ignore(e => e.Cities);
                entity.Ignore(e => e.Countries);
                entity.Ignore(e => e.Coupens);
                entity.Ignore(e => e.Orders);
                entity.Ignore(e => e.OrderItems);
                entity.Ignore(e => e.Products);
                entity.Ignore(e => e.ProductVarients);
                entity.Ignore(e => e.Reviews);
                entity.Ignore(e => e.Settings);
                entity.Ignore(e => e.ShippingAddresses);
                entity.Ignore(e => e.States);
                entity.Ignore(e => e.Users);
            });

            // Setting configuration
            modelBuilder.Entity<Setting>(entity =>
            {
                entity.HasKey(e => e.Id);
                entity.Property(e => e.TaxRate).HasPrecision(18, 2);
                entity.Property(e => e.DeliveryFee).HasPrecision(18, 2);
                entity.Property(e => e.FreeDeliveryAbove).HasPrecision(18, 2);
                
                // Ignore circular references
                entity.Ignore(e => e.Addresses);
                entity.Ignore(e => e.Carts);
                entity.Ignore(e => e.CartItems);
                entity.Ignore(e => e.Cities);
                entity.Ignore(e => e.Countries);
                entity.Ignore(e => e.Coupens);
                entity.Ignore(e => e.Orders);
                entity.Ignore(e => e.OrderItems);
                entity.Ignore(e => e.Products);
                entity.Ignore(e => e.ProductVarients);
                entity.Ignore(e => e.Reviews);
                entity.Ignore(e => e.Settings);
                entity.Ignore(e => e.ShippingAddresses);
                entity.Ignore(e => e.States);
                entity.Ignore(e => e.Users);
            });
        }
    }
}